# Module Federation å®éªŒä»“åº“

## ğŸ“ ç›®å½•è¯´æ˜

### åº”ç”¨é¡¹ç›®
- **app-mf-cra**: ç”± `npx create-react-app my-app` äº§ç”Ÿçš„åŸºç¡€é¡¹ç›®ï¼Œå¹¶æ‰§è¡Œ `pnpm eject` çš„ç»“æœï¼Œé¡¹ç›®ä»æœªæµ‹è¯•
- **app-mf-rsbuild**: ç”±[Module Federation å¿«é€Ÿä¸Šæ‰‹](https://module-federation.io/zh/guide/start/quick-start.html)äº§ç”Ÿï¼Œå…·ä½“æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå¹¶é€‰æ‹© application æ—¶äº§ç”Ÿ
  ```bash
  pnpm create module-federation@latest
  ```
- **app-mf-rspack**: æ ¹æ® [rspack æ–‡æ¡£](https://rspack.dev/zh/guide/start/quick-start#%E4%BD%BF%E7%94%A8-rspack-cli) äº§ç”Ÿï¼Œä»æœªä½¿ç”¨/æµ‹è¯•
- **app-mf-vite**: ç”± `pnpm create viet` äº§ç”ŸåŸºæœ¬é¡¹ç›®ï¼Œå¹¶æ ¹æ®[Module Federation vite plugin](https://module-federation.io/zh/guide/basic/vite.html)ç»“åˆ`git@github.com:gioboa/react-microfrontend-demo.git`/`git@github.com:module-federation/module-federation-examples.git` äº§ç”Ÿ
- **app-mf-webpack**: ç”± AI ç”Ÿæˆï¼Œå¯ä»¥è¿è¡Œï¼Œç»“åˆ [module-federation-plugin](https://webpack.docschina.org/plugins/module-federation-plugin/) æ–‡æ¡£äº§ç”Ÿ

### åº“é¡¹ç›®
- **lib-mf-rsbuild**: æ ¹æ®[rsbuild å¿«é€Ÿä¸Šæ‰‹](https://rsbuild.dev/zh/guide/start/quick-start)ï¼Œå¹¶[æ‰‹åŠ¨æ­å»º](https://module-federation.io/zh/guide/basic/rsbuild.html)çš„ Module Federation é¡¹ç›®
- **lib-mf-rslib**: ç”±[Module Federation å¿«é€Ÿä¸Šæ‰‹](https://module-federation.io/zh/guide/start/quick-start.html)ä»¥ä¸‹å‘½ä»¤ï¼Œå¹¶é€‰æ‹©`lib`æ—¶äº§ç”Ÿ
- **lib-mf-vite**: ç”± `pnpm create viet` äº§ç”ŸåŸºæœ¬é¡¹ç›®ï¼Œå¹¶æ ¹æ®[Module Federation vite plugin](https://module-federation.io/zh/guide/basic/vite.html)ç»“åˆ [module-federation vite plugin](https://module-federation.io/zh/guide/basic/vite.html) äº§ç”Ÿ
- **lib-mf-webpack**: ç”± AI ç”Ÿæˆï¼Œå¯ä»¥è¿è¡Œï¼Œç»“åˆ [module-federation-plugin](https://webpack.docschina.org/plugins/module-federation-plugin/) æ–‡æ¡£äº§ç”Ÿï¼Œä½†å…¶äº§ç”Ÿçš„ mf ä¸èƒ½è¢«å…¶ä»–é¡¹ç›®ä½¿ç”¨

## âš ï¸ ä¸¥é‡ Bug

1. ç”± `pnpm create module-federation@latest` å‘½ä»¤äº§ç”Ÿçš„ åˆå§‹é¡¹ç›® ä¾èµ–ç›¸äº’ä¹‹é—´ä¸åŒ¹é…, å¯¼è‡´ å‘½ä»¤åˆ›å»ºçš„é¡¹ç›®ä¸èƒ½ç›´æ¥ä½¿ç”¨, é™¤é å…¨é‡ `update` ä¸€æ¬¡
2. remote/expose çš„é…ç½® key ä¸èƒ½åŒ…å« `-`ï¼Œå¦åˆ™åœ¨åŸºäºrspackçš„é¡¹ç›®è‡ªåŠ¨æ‰“åŒ…æ—¶ä¼šæŠ¥é”™å¹¶æ— æ³•æˆåŠŸæ„å»º,å°±ç®—æ„å»ºæˆåŠŸå¯èƒ½ä¹Ÿæ— æ³•åœ¨å¼•ç”¨ç«¯æ­£å¸¸ä½¿ç”¨

## ğŸ“‹ é¡¹ç›®è¯´æ˜

### app-mf-cra
create react app ä»æœªæµ‹è¯•

### app-mf-rsbuild
ä½¿ç”¨ rsbuild åˆ›å»ºçš„åº”ç”¨

è¿è¡Œåœ°å€ï¼š`http://localhost:4010/`

#### å¯åŠ¨é¢„è§ˆ
```bash
pnpm run dev
```

#### æµ‹è¯•ç»“æœ
- âœ… ä½¿ç”¨ `rslib` `mf-manifest` (4000ç«¯å£) åè®®æ­£å¸¸ä½¿ç”¨
- âœ… ä½¿ç”¨ `rsbuild` `mf-manifest`(4070ç«¯å£) åè®®æ­£å¸¸ä½¿ç”¨
- âŒ ä½¿ç”¨ `rslib` `remoteEntry.js`(4000ç«¯å£) è¿œç¨‹æ–‡ä»¶æŠ¥é”™
  ```text
  index.cjs.cjs:21  Uncaught (in promise) Error: [ Federation Runtime ]: remoteEntryExports is undefined 
  {
    "alias": "provider",
    "name": "lib-mf-rslib",
    "entry": "http://localhost:4000/mf_provider.js",
    "externalType": "script",
    "shareScope": "default",
    "type": "global",
    "entryGlobalName": "lib-mf-rslib"
  }
  while loading "." from webpack/container/reference/provider
  ```
- âœ… ä½¿ç”¨ `rsbuild` `remoteEntry.js` (4070ç«¯å£) è¿œç¨‹æ–‡ä»¶æ­£å¸¸ä½¿ç”¨
- âŒ ä½¿ç”¨ `webpack` `remoteEntry.js` (4080ç«¯å£) è¿œç¨‹æ–‡ä»¶æŠ¥é”™
  ```text
  remoteEntry.js:163 [webpack-dev-server] Server started: Hot Module Replacement enabled, Live Reloading enabled, Progress disabled, Overlay enabled.
  remoteEntry.js:326 [HMR] Waiting for update signal from WDS...
  container_entry:12  Uncaught (in promise) Error: Module "." does not exist in container.
  while loading "." from webpack/container/reference/provider
  ```

### app-mf-rspack
åŸºäº `rspack` åˆ›å»ºçš„åº”ç”¨ï¼Œä»æœªæµ‹è¯•

### app-mf-vite
åŸºäº vite åˆ›å»ºçš„åº”ç”¨

#### å¯åŠ¨å¼€å‘é¢„è§ˆ
```bash
pnpm run dev
```

è¿è¡Œåœ°å€ï¼š`http://localhost:5173/`

#### æµ‹è¯•ç»“æœ
- âœ… å¯¹ rslib mf-manifest (4000ç«¯å£) åè®®æ­£å¸¸ä½¿ç”¨
- âœ… å¯¹ rsbuild mf-manifest (4070ç«¯å£) åè®®æ­£å¸¸ä½¿ç”¨
- âœ… å¯¹ rslib mf_provider.js (4000ç«¯å£) è¿œç¨‹æ–‡ä»¶æ­£å¸¸ä½¿ç”¨
- âœ… å¯¹ rsbuild remoteEntry.js (4070) è¿œç¨‹æ–‡ä»¶æ­£å¸¸ä½¿ç”¨
- âŒ å¯¹ vite mf-manifest (4050) åè®®æ— æ³•è§£æ
- âŒ å¯¹ vite remoteEntry.js (4050) æŠ¥é”™
  ```text
  remoteEntry.js:2  Uncaught SyntaxError: Cannot use import statement outside a module (at remoteEntry.js:2:3)
  index.cjs.js:21  Uncaught Error: [ Federation Runtime ]: remoteEntryExports is undefined 
  {
    "entryGlobalName": "vite_mf_components",
    "name": "mf_rsbuild_components",
    "type": "var",
    "entry": "http://localhost:4050/remoteEntry.js",
    "shareScope": "default"
  }
  ```
- âŒ ä½¿ç”¨ webpack remoteEntry.js (4080) è¿œç¨‹æ–‡ä»¶æŠ¥é”™
  ```text
  remoteEntry.js:163 [webpack-dev-server] Server started: Hot Module Replacement enabled, Live Reloading enabled, Progress disabled, Overlay enabled.
  remoteEntry.js:326 [HMR] Waiting for update signal from WDS...
  container_entry:12  Uncaught Error: Module "." does not exist in container.
  ```

### app-mf-webpack
åŸºäº webpack åˆ›å»ºçš„ app

#### è¿è¡Œé¢„è§ˆ
```bash
pnpm run start
```

é¢„è§ˆåœ°å€ï¼š`http://localhost:4090/`

#### æµ‹è¯•ç»“æœ
- âœ… æ‹‰å– rslib mf_provider.js æ­£å¸¸è¿è¡Œ
- âœ… rsbuild remoteEntry.js æ­£å¸¸è¿è¡Œ
- âŒ webpack remoteEntry.js æŠ¥é”™
  ```text
  VM235 index.js:485 [webpack-dev-server] Server started: Hot Module Replacement enabled, Live Reloading enabled, Progress disabled, Overlay enabled.
  VM228 log.js:39 [HMR] Waiting for update signal from WDS...
  remoteEntry.js:163 [webpack-dev-server] Server started: Hot Module Replacement enabled, Live Reloading enabled, Progress disabled, Overlay enabled.
  remoteEntry.js:326 [HMR] Waiting for update signal from WDS...
  container_entry:12  Uncaught (in promise) Error: Module "." does not exist in container.
  while loading "." from webpack/container/reference/provider
  ```

### lib-mf-rsbuild
åŸºäº `rsbuild` çš„æ¨¡å—è”é‚¦é¡¹ç›®

#### è¿è¡Œå‘½ä»¤
```bash
pnpm run dev
```

#### åŸºæœ¬ä¿¡æ¯
1. åŸºäº rsbuild åˆ›å»ºçš„æ¨¡å—è”é‚¦è¿œç¨‹æ¨¡å—é¡¹ç›®
2. ä½¿ç”¨æ’ä»¶ `@module-federation/rsbuild-plugin` æ„å»º
3. è¿è¡Œç«¯å£ `4070`

#### å¯¼å‡ºæ¨¡å—
æ¨¡å—åç§°ï¼š`rsbuild_mf_components`

1. åè®®ï¼šhttp://localhost:4070/mf-manifest.json
2. è„šæœ¬ï¼šhttp://localhost:4070/remoteEntry.js

### lib-mf-rslib

#### è¿è¡Œå‘½ä»¤
å®æ—¶ç¼–è¯‘ï¼š
```bash
pnpm run dev
```

è¿è¡Œé¢„è§ˆæœåŠ¡å™¨ï¼Œæš´éœ²è¿œç¨‹æ¨¡å—ï¼ˆè¿è¡Œæ¨¡å—è”é‚¦ï¼‰ï¼š
```bash
pnpm run mf-dev
```

#### åŸºæœ¬ä¿¡æ¯
1. åŸºäº rsbuild åˆ›å»ºçš„æ¨¡å—è”é‚¦è¿œç¨‹æ¨¡å—é¡¹ç›®
2. ä½¿ç”¨æ’ä»¶ `@module-federation/rsbuild-plugin` æ„å»º
3. è¿è¡Œç«¯å£ 4000

#### å¯¼å‡ºæ¨¡å—
æ¨¡å—åç§°ï¼š`mf_provider`

1. åè®®ï¼šhttp://localhost:4000/mf-manifest.json
2. è„šæœ¬ï¼šhttp://localhost:4000/mf_provider.js

### lib-mf-vite
ä½¿ç”¨ vite æ„å»ºçš„æ¨¡å—è”é‚¦åº”ç”¨

#### è¿è¡Œå‘½ä»¤
è¿è¡Œé¢„è§ˆï¼Œå¹¶æš´éœ²æ¨¡å—è”é‚¦ï¼š
```bash
pnpm run dev
```

#### åŸºæœ¬ä¿¡æ¯
1. åŸºäº vitejs åˆ›å»ºçš„æ¨¡å—è”é‚¦è¿œç¨‹æ¨¡å—é¡¹ç›®
2. ä½¿ç”¨æ’ä»¶ `@module-federation/vite` æ„å»º
3. å¼€å‘æœåŠ¡å™¨è¿è¡Œç«¯å£ 4050
4. é¢„è§ˆæœåŠ¡å™¨è¿è¡Œç«¯å£ 4060

#### å¯¼å‡ºæ¨¡å—
æ¨¡å—åç§°ï¼š`vite_mf_components`

1. åè®®ï¼šhttp://localhost:4050/mf-manifest.json
2. è„šæœ¬ï¼šhttp://localhost:4050/remoteEntry.js

### lib-mf-webpack
åŸºäº webpack æ„å»ºçš„æ¨¡å—è”é‚¦

#### è¿è¡Œé¢„è§ˆ
```bash
pnpm run start
```

#### åŸºæœ¬ä¿¡æ¯
1. åŸºäº webpack åˆ›å»ºçš„æ¨¡å—è”é‚¦è¿œç¨‹æ¨¡å—é¡¹ç›®
2. ä½¿ç”¨æ’ä»¶ webpack å†…ç½®æ¨¡å—è”é‚¦æ’ä»¶ `webpack/container/ModuleFederationPlugin` æ„å»º
3. é¢„è§ˆæœåŠ¡å™¨è¿è¡Œç«¯å£ 4080

#### å¯¼å‡ºæ¨¡å—
æ¨¡å—åç§°ï¼š`mf_webpack`

1. è„šæœ¬ï¼šhttp://localhost:4080/remoteEntry.js

